<html>

<body>
    <canvas id="canvas" style="width: 100%; height: 100%"></canvas>
    <script type="text/javascript" src="../../dist/jsbundle/spark-engine-web.js"></script>
    <script>
        const context = document.getElementById('canvas').getContext('2d');
        const engine = new SparkEngine.GameEngine({
            context,
            framerate: 30,
            resolution: { width: 1920, height: 1080 }
        });

        const scene = engine.createScene();

        const leftWall = new SparkEngine.StaticObject();
        leftWall.transform.size = { width: 20, height: 150 };
        leftWall.transform.position = new SparkEngine.Vec2(10, 75); // Adjusted for center origin: 0 + (20/2), 0 + (150/2)
        leftWall.material.diffuseColor = new SparkEngine.Rgb(255, 0, 0);
        leftWall.boundingBox.matchContainerTransform = true;

        const rightWall = new SparkEngine.StaticObject();
        rightWall.transform.size = { width: 20, height: 150 };
        rightWall.transform.position = new SparkEngine.Vec2(290, 75); // Adjusted for center origin: 280 + (20/2), 0 + (150/2)
        rightWall.material.diffuseColor = new SparkEngine.Rgb(0, 0, 255);
        rightWall.boundingBox.matchContainerTransform = true;

        const player = new SparkEngine.StaticObject({
            material: {
                diffuseColor: new SparkEngine.Rgb(0, 0, 0)
            }
        });
        player.transform.size = { width: 10, height: 10 };
        player.transform.position = new SparkEngine.Vec2(30, 30); // Adjusted for center origin: 25 + (10/2), 25 + (10/2)
        player.boundingBox.matchContainerTransform = true;

        const playerController = new SparkEngine.InputComponent();
        player.addComponent(playerController);

        playerController.onInputEventCb = (({ KeyW, KeyS, KeyA, KeyD }) => {
            const parentTransform = playerController.getContainer().getComponent('TransformComponent');

            if (KeyW === SparkEngine.KeyStatus.Down) {
                parentTransform.velocity.y = -2;
            } else if (KeyS === SparkEngine.KeyStatus.Down) {
                parentTransform.velocity.y = 2;
            } else {
                parentTransform.velocity.y = 0;

            }

            if (KeyD === SparkEngine.KeyStatus.Down) {
                parentTransform.velocity.x = 2;
                isInput = true;
            } else if (KeyA === SparkEngine.KeyStatus.Down) {
                parentTransform.velocity.x = -2;
                isInput = true;
            } else {
                parentTransform.velocity.x = -0;
            }
        });


        const movableObject = new SparkEngine.StaticObject();
        movableObject.transform.size = { width: 30, height: 30 };
        movableObject.transform.position = new SparkEngine.Vec2(70, 70); // Adjusted for center origin: 55 + (30/2), 55 + (30/2)
        movableObject.material.diffuseColor = new SparkEngine.Rgb(255, 0, 0);
        movableObject.boundingBox.matchContainerTransform = true;

        const movableObjectWithRebound = new SparkEngine.StaticObject();
        movableObjectWithRebound.transform.size = { width: 15, height: 15 };
        movableObjectWithRebound.transform.position = new SparkEngine.Vec2(77.5, 77.5); // Adjusted for center origin: 70 + (15/2), 70 + (15/2)
        movableObjectWithRebound.material.diffuseColor = new SparkEngine.Rgb(0, 255, 0);
        movableObjectWithRebound.boundingBox.matchContainerTransform = true;

        movableObject.boundingBox.onCollisionCb = ({ collider, postSimulation }) => {
            // Convert from physics top-left coordinates to center coordinates
            movableObject.transform.position = new SparkEngine.Vec2(
                postSimulation.aabb[0] + movableObject.transform.size.width / 2, 
                postSimulation.aabb[1] + movableObject.transform.size.height / 2
            );
        }

        movableObjectWithRebound.boundingBox.onCollisionCb = ({ collider, postSimulation }) => {
            // Convert from physics top-left coordinates to center coordinates
            movableObjectWithRebound.transform.position = new SparkEngine.Vec2(
                postSimulation.aabb[0] + movableObjectWithRebound.transform.size.width / 2, 
                postSimulation.aabb[1] + movableObjectWithRebound.transform.size.height / 2
            );
        }

        player.boundingBox.onCollisionCb = ({ collider, postSimulation }) => {
            // Convert from physics top-left coordinates to center coordinates
            player.transform.position = new SparkEngine.Vec2(
                postSimulation.aabb[0] + player.transform.size.width / 2, 
                postSimulation.aabb[1] + player.transform.size.height / 2
            );
        }

        scene.registerEntity(movableObject);
        scene.registerEntity(movableObjectWithRebound);
        scene.registerEntity(leftWall);
        scene.registerEntity(rightWall);
        scene.registerEntity(player);


        engine.run();
    </script>
</body>

</html>